<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Lokesh Mano • 23-Oct-2020" />


<title>Phylogenetics</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="assets/lab.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"><b>NBIS • Workshop on ggplot</b></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="schedule.html">
    <span class="fa fa-clipboard-list"></span>
     
    Schedule
  </a>
</li>
<li>
  <a href="lab.html">
    <span class="fa fa-flask"></span>
     
    Lab
  </a>
</li>
<li>
  <a href="precourse.html">
    <span class="fa fa-pencil-alt"></span>
     
    Precourse
  </a>
</li>
<li>
  <a href="info.html">
    <span class="fa fa-info"></span>
     
    Info
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Phylogenetics</h1>
<h3 class="subtitle">Workshop on ggplot</h3>
<h4 class="author"><b>Lokesh Mano</b> • 23-Oct-2020</h4>

</div>


<!-- rmd lab header -->
<!-- custom fonts -->
<p><link href="https://fonts.googleapis.com/css?family=Roboto|Source+Sans+Pro:300,400,600|Ubuntu+Mono&amp;subset=latin-ext" rel="stylesheet"></p>
<p><br></p>
<div class="block-title-parent">
<div class="block-title small">
Output
</div>
</div>
<p>For this course, I have used one of my very simple tree from a few different organisms within the Archaea superkingdom. More specifically, it is the concatenated ribosomal protein tree within archaea, with representatives from the different Phyla: Asgard archaea (Thorarchaeota, Odinarchaeota, Lokiarchaeota and Heimdallarchaeota), TACK, Euryarchaeota and DPANN. The maximum likelihood phylogeny was reconstructed in IQ-TREE with the LG+F+I+G4 model. The alignment was trimmed to 6,732 positions with the BMGE (Block Mapping and Gathering with Entropy) tool.</p>
<div id="ggtree" class="section level1">
<h1><span class="header-section-number">1</span> ggtree</h1>
<p><code>ggtree</code> is an R package that extends ggplot2 for visualizating and annotating phylogenetic trees with their covariates and other associated data. <code>ggtree</code> in combination with <code>treeio</code> supports several file formats, including:</p>
<ul>
<li><code>read.tree</code> for reading Newick files.</li>
<li><code>read.phylip</code> for reading Phylip files.</li>
<li><code>read.jplace</code> for reading Jplace files.</li>
<li><code>read.nhx</code> for reading NHX files.</li>
<li><code>read.beast</code> for parsing output of BEAST</li>
<li><code>read.codeml</code> for parsing output of CODEML (rst and mlc files)</li>
<li><code>read.codeml_mlc</code> for parsing mlc file (output of CODEML)</li>
<li><code>read.hyphy</code> for parsing output of HYPHY</li>
<li><code>read.jplace</code> for parsing jplace file including output from EPA and pplacer</li>
<li><code>read.nhx</code> for parsing NHX file including output from PHYLODOG and RevBayes</li>
<li><code>read.paml_rst</code> for parsing rst file (output of BASEML and CODEML)</li>
<li><code>read.r8s</code> for parsing output of r8s</li>
<li><code>read.raxml</code> for parsing output of RAxML</li>
</ul>
</div>
<div id="reading-treefile" class="section level1">
<h1><span class="header-section-number">2</span> Reading treefile</h1>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(ggtree)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(treeio)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">arch_tree &lt;-<span class="st"> </span><span class="kw">read.newick</span>(<span class="st">&quot;data/arch_newick.txt&quot;</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">arch_tree</a></code></pre></div>
<details>
<p><summary>output</summary></p>
<pre><code>## 
## Phylogenetic tree with 25 tips and 24 internal nodes.
## 
## Tip labels:
##   DPANN_Pace_RBG_13_36_9, DPANN_Woese_UBA94, EURY_Thermoplasma_volcanium_GSS1, Eury_Halobaculum_gomorrense, Eury_Methanothermococcus_okinawensis, TACK_Bathy_SMTZ80, ...
## Node labels:
##   100, 10.9, 100, 100, 72, 35.9, ...
## 
## Rooted; includes branch lengths.</code></pre>
</details>
</div>
<p>Just like with <code>ggplot2</code> we created a basic canvas with <code>ggplot(...)</code> and added layers with <code>+geom_???()</code>, we can do the same here. The <code>ggtree</code> package gives us a <code>geom_tree()</code> function. Because <code>ggtree</code> is built on top of <code>ggplot2</code>, you get <code>ggplot2</code>’s default gray theme with white lines. You can override this with a theme from the <code>ggtree</code> package.</p>
<p>Because you’ll almost always want to add a tree geom and remove the default background and axes, the <code>ggtree()</code> function is essentially a shortcut for <code>ggplot(...) + geom_tree() + theme_tree()</code>.</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">ggtree</span>(arch_tree)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#Same as:</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#ggplot(arch_tree) + geom_tree() + theme_tree()</span></a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-5-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<p>One can also customize how the tree looks like, just as in <code>ggplot</code></p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">ggtree</span>(arch_tree, <span class="dt">branch.length=</span><span class="st">&quot;none&quot;</span>, <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">size=</span><span class="dv">2</span>, <span class="dt">linetype=</span><span class="dv">3</span>)</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-6-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<p>You can also use different orientations to show the tree.</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">ggtree</span>(arch_tree, <span class="dt">color=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">layout =</span> <span class="st">&quot;circular&quot;</span>)</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-7-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
</div>
<div id="geoms-and-annotation" class="section level1">
<h1><span class="header-section-number">3</span> Geoms and annotation</h1>
<p>Just like in <code>ggplot()</code> you can add layers to the tree as <code>geoms</code>.</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(arch_tree)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>(<span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_tree2</span>()</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-8-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<p>Before we can go further into annotating the tree, we need to understand how ggtree is handling the tree structure internally. Some of the functions in ggtree for annotating clades need a parameter specifying the internal node number. To get the internal node number, user can use <code>geom_text</code> to display it, where the label is an aesthetic mapping to the “node variable” stored inside the tree object (think of this like the continent variable inside the gapminder object).</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label=</span>node), <span class="dt">hjust=</span><span class="op">-</span>.<span class="dv">3</span>)</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-9-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<p>Another way to get the internal node number is using the function <code>MRCA()</code> which stands for Most Recent Common Ancestor. From the tree above, if you would like to get the number of the particular node that is common to all the “Lokiarchaea”. You can do so like below:</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">MRCA</span>(arch_tree, <span class="dt">.node1 =</span> <span class="st">&quot;Baja_Loki3&quot;</span>, <span class="dt">.node2 =</span>  <span class="st">&quot;Loki_CR4&quot;</span>)</a></code></pre></div>
<details>
<p><summary>output</summary></p>
<pre><code>## [1] 46</code></pre>
</details>
</div>
<div id="clade-labeling" class="section level2">
<h2><span class="header-section-number">3.1</span> Clade labeling</h2>
<p>Now, let us see how we can use this information to make it scientifically intuitive.</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">p <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_cladelabel</span>(<span class="dt">node=</span><span class="dv">46</span>, <span class="dt">label=</span><span class="st">&quot;Lokiarchaeota&quot;</span>, <span class="dt">color=</span><span class="st">&quot;green&quot;</span>)</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-11-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<p>ALternatively, we can also highlight an entire clade:</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">p <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_hilight</span>(<span class="dt">node=</span><span class="dv">39</span>, <span class="dt">fill =</span> <span class="st">&quot;purple&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_cladelabel</span>(<span class="dt">node=</span><span class="dv">39</span>, <span class="dt">label=</span><span class="st">&quot;Thorarchaeota&quot;</span>, <span class="dt">color=</span><span class="st">&quot;purple&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_hilight</span>(<span class="dt">node=</span><span class="dv">46</span>, <span class="dt">fill =</span> <span class="st">&quot;green&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_cladelabel</span>(<span class="dt">node=</span><span class="dv">46</span>, <span class="dt">label=</span><span class="st">&quot;Lokiarchaeota&quot;</span>, <span class="dt">color=</span><span class="st">&quot;green&quot;</span>)</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-12-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
</div>
<div id="taxa-connections" class="section level2">
<h2><span class="header-section-number">3.2</span> Taxa connections</h2>
<p>You can make connections to represent processes like gene transfer events on the tree.</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">p <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_hilight</span>(<span class="dt">node=</span><span class="dv">30</span>, <span class="dt">fill =</span> <span class="st">&quot;orange&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_cladelabel</span>(<span class="dt">node=</span><span class="dv">30</span>, <span class="dt">label=</span><span class="st">&quot;Euryarchaeota&quot;</span>, <span class="dt">color=</span><span class="st">&quot;orange&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_hilight</span>(<span class="dt">node=</span><span class="dv">46</span>, <span class="dt">fill =</span> <span class="st">&quot;green&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_cladelabel</span>(<span class="dt">node=</span><span class="dv">46</span>, <span class="dt">label=</span><span class="st">&quot;Lokiarchaeota&quot;</span>, <span class="dt">color=</span><span class="st">&quot;green&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_taxalink</span>(<span class="st">&quot;Eury_Methanothermococcus_okinawensis&quot;</span>, <span class="st">&quot;Loki_GC14&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-13-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
</div>
<div id="group-clades-and-otus" class="section level2">
<h2><span class="header-section-number">3.3</span> Group clades and OTUs</h2>
<p>You can group the different tips using the <code>groupOTU</code> function or you can group the tips based on a node using <code>groupClade</code> function. These groups you can then further use it for other geoms and so on.</p>
<p>Let us say, we want to show the Asgrad archaea separately from the other archaea in this tree. One way to this would be:</p>
<div id="groupotu" class="section level3">
<h3><span class="header-section-number">3.3.1</span> groupOTU</h3>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">arch_tree &lt;-<span class="st"> </span><span class="kw">groupOTU</span>(arch_tree, <span class="kw">c</span>(<span class="st">&quot;DPANN_Pace_RBG_13_36_9&quot;</span>, <span class="st">&quot;DPANN_Woese_UBA94&quot;</span>,</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">                                   <span class="st">&quot;EURY_Thermoplasma_volcanium_GSS1&quot;</span>, <span class="st">&quot;Eury_Halobaculum_gomorrense&quot;</span>, <span class="st">&quot;Eury_Methanothermococcus_okinawensis&quot;</span>, </a>
<a class="sourceLine" id="cb13-3" data-line-number="3">                                   <span class="st">&quot;TACK_Bathy_SMTZ80&quot;</span>, <span class="st">&quot;TACK_Nitrososphaera_viennensis&quot;</span>, <span class="st">&quot;TACK_Sulfolobus_islandicus_LS215&quot;</span>))</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="kw">ggtree</span>(arch_tree, <span class="kw">aes</span>(<span class="dt">color=</span>group)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>()</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-14-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<p>We can also get more detailed:</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"> cls &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Heimdallarchaeota =</span> <span class="kw">c</span>(<span class="st">&quot;Heim_AB125&quot;</span>, <span class="st">&quot;Heim_LC2&quot;</span>, <span class="st">&quot;Heim_LC3&quot;</span>), </a>
<a class="sourceLine" id="cb14-2" data-line-number="2">             <span class="dt">Thorarchaeota =</span> <span class="kw">c</span>(<span class="st">&quot;Baja_Thor&quot;</span>, <span class="st">&quot;Thor_AB25&quot;</span>, <span class="st">&quot;Thor_MP11T&quot;</span>, <span class="st">&quot;Thor_SMTZ45&quot;</span>, <span class="st">&quot;Thor_SMTZ_145&quot;</span>, <span class="st">&quot;Thor_MP8T&quot;</span>, <span class="st">&quot;Thor_MP9T&quot;</span>, <span class="st">&quot;Thor_SMTZ_183&quot;</span>), </a>
<a class="sourceLine" id="cb14-3" data-line-number="3">             <span class="dt">Lokiarchaeota =</span> <span class="kw">c</span>(<span class="st">&quot;Loki_CR4&quot;</span>, <span class="st">&quot;Loki_GC14&quot;</span>, <span class="st">&quot;Baja_Loki2&quot;</span>, <span class="st">&quot;Baja_Loki1&quot;</span>, <span class="st">&quot;Baja_Loki3&quot;</span>),</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">             <span class="dt">Odinarchaeota =</span> <span class="st">&quot;Odin_LCB4&quot;</span>)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"></a>
<a class="sourceLine" id="cb14-6" data-line-number="6">arch_tree &lt;-<span class="st"> </span><span class="kw">groupOTU</span>(arch_tree, cls)</a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="kw">ggtree</span>(arch_tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>(<span class="kw">aes</span>(<span class="dt">color=</span>group)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="kw">rainbow</span>(<span class="dv">4</span>)), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;OutGroup&quot;</span>, <span class="kw">names</span>(cls)))</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-15-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<p>One thing to notice hear that you can group tips from different clades together as well.</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">baja &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">Baja =</span> <span class="kw">c</span>(<span class="st">&quot;Baja_Thor&quot;</span>, <span class="st">&quot;Baja_Loki2&quot;</span>, </a>
<a class="sourceLine" id="cb15-2" data-line-number="2">                      <span class="st">&quot;Baja_Loki1&quot;</span>, <span class="st">&quot;Baja_Loki3&quot;</span>))</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">arch_tree &lt;-<span class="st"> </span><span class="kw">groupOTU</span>(arch_tree, baja)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="kw">ggtree</span>(arch_tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>(<span class="kw">aes</span>(<span class="dt">color=</span>group)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;blue&quot;</span>), </a>
<a class="sourceLine" id="cb15-7" data-line-number="7">                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Public genomes&quot;</span>, <span class="st">&quot;Baja genomes&quot;</span>))</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-16-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
</div>
<div id="groupclade" class="section level3">
<h3><span class="header-section-number">3.3.2</span> groupClade</h3>
<p>Now, if we are only interested in showing the differences based on the clades, we can use <code>groupClade</code>.</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">arch_tree &lt;-<span class="st"> </span><span class="kw">groupClade</span>(arch_tree, <span class="kw">c</span>(<span class="dv">39</span>, <span class="dv">46</span>, <span class="dv">35</span>, <span class="dv">27</span>))</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="kw">ggtree</span>(arch_tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>(<span class="kw">aes</span>(<span class="dt">color=</span>group)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="kw">rainbow</span>(<span class="dv">4</span>), <span class="st">&quot;black&quot;</span>), </a>
<a class="sourceLine" id="cb16-5" data-line-number="5">                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Odin&quot;</span>, <span class="st">&quot;Thor&quot;</span>, <span class="st">&quot;Loki&quot;</span>, <span class="st">&quot;Heimdall&quot;</span>, <span class="st">&quot;OutGroup&quot;</span>))</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-17-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
</div>
</div>
<div id="showing-bootstrap-values" class="section level2">
<h2><span class="header-section-number">3.4</span> Showing bootstrap values</h2>
<p>If you notice the tree object, it actually contains <code>node.label</code> that are bootstrap values.</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">arch_tree</a></code></pre></div>
<details>
<p><summary>output</summary></p>
<pre><code>## 
## Phylogenetic tree with 25 tips and 24 internal nodes.
## 
## Tip labels:
##   DPANN_Pace_RBG_13_36_9, DPANN_Woese_UBA94, EURY_Thermoplasma_volcanium_GSS1, Eury_Halobaculum_gomorrense, Eury_Methanothermococcus_okinawensis, TACK_Bathy_SMTZ80, ...
## Node labels:
##   100, 10.9, 100, 100, 72, 35.9, ...
## 
## Rooted; includes branch lengths.</code></pre>
</details>
</div>
<p>There are different ways we could show this values on the tree. For example,</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">ggtree</span>(arch_tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_nodelab</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_tree</span>()</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-19-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<p>Now, let us say that you only want to show the values that are above 80, then you would have to do some trick here, like:</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">ggtree</span>(arch_tree) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_nodepoint</span>(<span class="kw">aes</span>(<span class="dt">subset =</span> <span class="kw">as.numeric</span>(label) <span class="op">&gt;</span><span class="st"> </span><span class="dv">80</span>), <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_tiplab</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="st">  </span><span class="kw">theme_tree</span>()</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-20-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<p><i class="fas fa-exclamation-circle"></i> Note   Notice that the <code>node.label</code> are in string, so must remember to use <code>as.numeric()</code> option be able to filter them to show them.</p>
<p><i class="fas fa-exclamation-circle"></i> Note   If the tree does not have bootstrap values with in the treefile, one can add them separately as a <code>data.frame</code> using <code>%&lt;+%</code> function, as shown in the <strong>Adding data to tree</strong> section below.</p>
</div>
<div id="subsetting-trees" class="section level2">
<h2><span class="header-section-number">3.5</span> Subsetting trees</h2>
<p>It is possible to specific <code>tips</code> from the tree using <code>drop.tip()</code> fuction. Let us say, we want to remove <code>Thor_SMTZ45</code> and <code>Baja_Loki1</code>, becuase of the reason that their genomes are not close to complete. We can do that by:</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">to_drop &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Thor_SMTZ45&quot;</span>, <span class="st">&quot;Baja_Loki1&quot;</span>)</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">arch_tree_reduced &lt;-<span class="st"> </span><span class="kw">drop.tip</span>(arch_tree, to_drop)</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">arch_tree_reduced &lt;-<span class="st"> </span><span class="kw">groupClade</span>(arch_tree_reduced, <span class="kw">c</span>(<span class="dv">37</span>, <span class="dv">43</span>, <span class="dv">33</span>, <span class="dv">25</span>))</a>
<a class="sourceLine" id="cb21-4" data-line-number="4"></a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="kw">ggtree</span>(arch_tree_reduced) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>(<span class="kw">aes</span>(<span class="dt">color=</span>group)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="kw">rainbow</span>(<span class="dv">4</span>), <span class="st">&quot;black&quot;</span>), </a>
<a class="sourceLine" id="cb21-7" data-line-number="7">                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Odin&quot;</span>, <span class="st">&quot;Thor&quot;</span>, <span class="st">&quot;Loki&quot;</span>, <span class="st">&quot;Heimdall&quot;</span>, <span class="st">&quot;OutGroup&quot;</span>))</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-21-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<p>One can also subset a tree, by using the internal node number as shown in the exercises earlier. We can do this by using the <code>tree_subset()</code> function:</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">asg_tree &lt;-<span class="st"> </span><span class="kw">tree_subset</span>(arch_tree, <span class="dt">node=</span><span class="dv">34</span>, <span class="dt">levels_back=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="kw">ggtree</span>(asg_tree) <span class="op">+</span><span class="st"> </span><span class="kw">geom_tiplab</span>() </a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-22-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<p><i class="fas fa-exclamation-circle"></i> Note   The branch lengths and all the other information from the tree are maintained in the new object, when remove tips or subset a tree.</p>
</div>
</div>
<div id="adding-data-to-tree" class="section level1">
<h1><span class="header-section-number">4</span> Adding data to tree</h1>
<p>In this part, let us try to see what kind of ways one could add metadata to a tree.</p>
<div id="tables" class="section level2">
<h2><span class="header-section-number">4.1</span> Tables</h2>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">env_info &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;data/tree_env.tsv&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, </a>
<a class="sourceLine" id="cb23-2" data-line-number="2">                <span class="dt">stringsAsFactor=</span>F, <span class="dt">row.names =</span> <span class="dv">1</span>, <span class="dt">header =</span> T)</a>
<a class="sourceLine" id="cb23-3" data-line-number="3"></a>
<a class="sourceLine" id="cb23-4" data-line-number="4">p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(arch_tree) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_tiplab</span>(<span class="kw">aes</span>(<span class="dt">color=</span>group)) <span class="op">+</span></a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="kw">rainbow</span>(<span class="dv">4</span>), <span class="st">&quot;black&quot;</span>), </a>
<a class="sourceLine" id="cb23-7" data-line-number="7">    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Odin&quot;</span>, <span class="st">&quot;Thor&quot;</span>, <span class="st">&quot;Loki&quot;</span>, <span class="st">&quot;Heimdall&quot;</span>, <span class="st">&quot;OutGroup&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb23-9" data-line-number="9"></a>
<a class="sourceLine" id="cb23-10" data-line-number="10"><span class="kw">gheatmap</span>(p, env_info, <span class="dt">offset =</span> <span class="dv">4</span>, <span class="dt">width=</span><span class="fl">1.5</span>, </a>
<a class="sourceLine" id="cb23-11" data-line-number="11">    <span class="dt">colnames_angle =</span> <span class="dv">90</span>, <span class="dt">colnames_offset_y =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb23-12" data-line-number="12">    <span class="dt">legend_title =</span> <span class="st">&quot;Environment sampled&quot;</span>) </a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-23-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<p>Similarly we can plot a heatmap:</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">env_hmap &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;data/tree_hmap.tsv&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, </a>
<a class="sourceLine" id="cb24-2" data-line-number="2">                <span class="dt">stringsAsFactor=</span>F, <span class="dt">row.names =</span> <span class="dv">1</span>, <span class="dt">header =</span> T)</a>
<a class="sourceLine" id="cb24-3" data-line-number="3"></a>
<a class="sourceLine" id="cb24-4" data-line-number="4">p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(arch_tree) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_tiplab</span>(<span class="kw">aes</span>(<span class="dt">color=</span>group)) <span class="op">+</span></a>
<a class="sourceLine" id="cb24-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="kw">rainbow</span>(<span class="dv">4</span>), <span class="st">&quot;black&quot;</span>), </a>
<a class="sourceLine" id="cb24-7" data-line-number="7">    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Odin&quot;</span>, <span class="st">&quot;Thor&quot;</span>, <span class="st">&quot;Loki&quot;</span>, <span class="st">&quot;Heimdall&quot;</span>, <span class="st">&quot;OutGroup&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb24-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb24-9" data-line-number="9"></a>
<a class="sourceLine" id="cb24-10" data-line-number="10"><span class="kw">gheatmap</span>(p, env_hmap, <span class="dt">offset =</span> <span class="dv">4</span>, <span class="dt">width=</span><span class="fl">1.5</span>, </a>
<a class="sourceLine" id="cb24-11" data-line-number="11">    <span class="dt">colnames_angle =</span> <span class="dv">90</span>, <span class="dt">colnames_offset_y =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb24-12" data-line-number="12">    <span class="dt">legend_title =</span> <span class="st">&quot;Environment sampled&quot;</span>) </a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-24-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
</div>
<div id="images" class="section level2">
<h2><span class="header-section-number">4.2</span> Images</h2>
<p>One can use <a href="http://phylopic.org/">phylopic</a> database, which is part of the <code>ggtree</code> package to use many silhouette images of organisms. Here, we can see how one could add some of those images to a tree.</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="cf">if</span> (<span class="op">!</span><span class="kw">requireNamespace</span>(<span class="st">&quot;ggimage&quot;</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">    <span class="kw">install.packages</span>(<span class="st">&quot;ggimage&quot;</span>, <span class="dt">dependencies =</span> <span class="ot">TRUE</span> )</a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="kw">library</span>(ggimage)</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(arch_tree) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_tiplab</span>(<span class="kw">aes</span>(<span class="dt">color=</span>group)) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="kw">rainbow</span>(<span class="dv">4</span>), <span class="st">&quot;black&quot;</span>), </a>
<a class="sourceLine" id="cb25-7" data-line-number="7">    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Odin&quot;</span>, <span class="st">&quot;Thor&quot;</span>, <span class="st">&quot;Loki&quot;</span>, <span class="st">&quot;Heimdall&quot;</span>, <span class="st">&quot;OutGroup&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-8" data-line-number="8"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb25-9" data-line-number="9"></a>
<a class="sourceLine" id="cb25-10" data-line-number="10">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_phylopic</span>(<span class="dt">size =</span> <span class="ot">Inf</span>, <span class="dt">image =</span> <span class="st">&quot;e4dde003-8a3b-4c9e-b4ed-1f6e4d894163&quot;</span>, </a>
<a class="sourceLine" id="cb25-11" data-line-number="11">                  <span class="dt">color=</span><span class="st">&quot;steelblue&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.3</span>)</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-25-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<p>One can add specific images to the specific nodes as well. For this, we would include the <code>phylopic</code> information as a dataframe and which specific node number, should these images be matched. Then we could add this information to the <code>ggtree</code> object using <code>%&lt;+%</code> function.</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">phylopic_info &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">node =</span> <span class="kw">c</span>(<span class="dv">39</span>, <span class="dv">46</span>, <span class="dv">35</span>, <span class="dv">27</span>, <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb26-2" data-line-number="2">                            <span class="dt">phylopic =</span> <span class="kw">c</span>(<span class="st">&quot;6b79f4f2-3c34-4130-9e60-4ba2fe68ff48&quot;</span>,</a>
<a class="sourceLine" id="cb26-3" data-line-number="3">                                        <span class="st">&quot;f04e96a5-8c19-4caf-af64-ee51e69431fd&quot;</span>,</a>
<a class="sourceLine" id="cb26-4" data-line-number="4">                                        <span class="st">&quot;e4dde003-8a3b-4c9e-b4ed-1f6e4d894163&quot;</span>,</a>
<a class="sourceLine" id="cb26-5" data-line-number="5">                                        <span class="st">&quot;3cabf30c-eed6-4dc4-824e-f7eac992f554&quot;</span>,</a>
<a class="sourceLine" id="cb26-6" data-line-number="6">                                        <span class="st">&quot;5254d3c6-6865-46c4-beaa-4a9306a50bc8&quot;</span>))</a>
<a class="sourceLine" id="cb26-7" data-line-number="7"></a>
<a class="sourceLine" id="cb26-8" data-line-number="8">p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(arch_tree) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb26-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_tiplab</span>(<span class="kw">aes</span>(<span class="dt">color=</span>group)) <span class="op">+</span></a>
<a class="sourceLine" id="cb26-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="kw">rainbow</span>(<span class="dv">4</span>), <span class="st">&quot;black&quot;</span>), </a>
<a class="sourceLine" id="cb26-11" data-line-number="11">    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Odin&quot;</span>, <span class="st">&quot;Thor&quot;</span>, <span class="st">&quot;Loki&quot;</span>, <span class="st">&quot;Heimdall&quot;</span>, <span class="st">&quot;OutGroup&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb26-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb26-13" data-line-number="13"></a>
<a class="sourceLine" id="cb26-14" data-line-number="14">p <span class="op">%&lt;+%</span><span class="st"> </span>phylopic_info <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb26-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_nodelab</span>(<span class="kw">aes</span>(<span class="dt">image=</span>phylopic), </a>
<a class="sourceLine" id="cb26-16" data-line-number="16">               <span class="dt">geom=</span><span class="st">&quot;phylopic&quot;</span>, <span class="dt">alpha=</span>.<span class="dv">8</span>, <span class="dt">color=</span><span class="st">&#39;steelblue&#39;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb26-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_tiplab</span>(<span class="kw">aes</span>(<span class="dt">image=</span>phylopic), </a>
<a class="sourceLine" id="cb26-18" data-line-number="18">              <span class="dt">geom=</span><span class="st">&quot;phylopic&quot;</span>, <span class="dt">alpha=</span>.<span class="dv">8</span>, <span class="dt">color=</span><span class="st">&#39;steelblue&#39;</span>)</a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-26-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
<p><i class="fas fa-exclamation-circle"></i> Note   Notice that for <code>Odin</code>, we had to use <code>geom_tiplab()</code> as it is a tip and not a node!</p>
<p>There are more fun images in <code>phylopic</code> that one can use:</p>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">phylopic_info &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">node =</span> <span class="kw">c</span>(<span class="dv">39</span>, <span class="dv">46</span>, <span class="dv">35</span>, <span class="dv">27</span>, <span class="dv">38</span>),</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">                  <span class="dt">phylopic =</span> <span class="kw">c</span>(<span class="st">&quot;bac25f49-97a4-4aec-beb6-f542158ebd23&quot;</span>,</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">                               <span class="st">&quot;f598fb39-facf-43ea-a576-1861304b2fe4&quot;</span>,</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">                               <span class="st">&quot;aceb287d-84cf-46f1-868c-4797c4ac54a8&quot;</span>,</a>
<a class="sourceLine" id="cb27-5" data-line-number="5">                               <span class="st">&quot;0174801d-15a6-4668-bfe0-4c421fbe51e8&quot;</span>,</a>
<a class="sourceLine" id="cb27-6" data-line-number="6">                               <span class="st">&quot;72f2f854-f3cd-4666-887c-35d5c256ab0f&quot;</span>))</a>
<a class="sourceLine" id="cb27-7" data-line-number="7"></a>
<a class="sourceLine" id="cb27-8" data-line-number="8">p &lt;-<span class="st"> </span><span class="kw">ggtree</span>(arch_tree) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_tiplab</span>(<span class="kw">aes</span>(<span class="dt">color=</span>group)) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="kw">rainbow</span>(<span class="dv">4</span>), <span class="st">&quot;black&quot;</span>), </a>
<a class="sourceLine" id="cb27-11" data-line-number="11">    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Odin&quot;</span>, <span class="st">&quot;Thor&quot;</span>, <span class="st">&quot;Loki&quot;</span>, <span class="st">&quot;Heimdall&quot;</span>, <span class="st">&quot;OutGroup&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</a>
<a class="sourceLine" id="cb27-13" data-line-number="13"></a>
<a class="sourceLine" id="cb27-14" data-line-number="14">p <span class="op">%&lt;+%</span><span class="st"> </span>phylopic_info <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_nodelab</span>(<span class="kw">aes</span>(<span class="dt">image=</span>phylopic), <span class="dt">geom=</span><span class="st">&quot;phylopic&quot;</span>, </a>
<a class="sourceLine" id="cb27-16" data-line-number="16">               <span class="dt">alpha=</span>.<span class="dv">8</span>, <span class="dt">color=</span><span class="st">&#39;steelblue&#39;</span>) </a></code></pre></div>
<details>
<p><summary>plot</summary></p>
<p><img src="lab_phylo_files/figure-html/unnamed-chunk-27-1.svg" width="672" style="display: block; margin: auto auto auto 0;" /></p>
</details>
</div>
</div>
</div>
<div id="session-info" class="section level1">
<h1><span class="header-section-number">5</span> Session info</h1>
<div class="block-title-parent">
<div class="block-title small">
R
</div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.6.3 (2020-02-29)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.1 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0
## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] ggimage_0.2.8   treeio_1.10.0   ggtree_2.0.4    forcats_0.5.0  
##  [5] stringr_1.4.0   purrr_0.3.4     readr_1.3.1     tidyr_1.1.1    
##  [9] tibble_3.0.3    tidyverse_1.3.0 reshape2_1.4.4  ggplot2_3.3.2  
## [13] dplyr_1.0.1     captioner_2.2.3 bookdown_0.20   knitr_1.29     
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.5          lubridate_1.7.9     ape_5.4-1          
##  [4] lattice_0.20-40     assertthat_0.2.1    digest_0.6.25      
##  [7] R6_2.4.1            cellranger_1.1.0    plyr_1.8.6         
## [10] backports_1.1.8     reprex_0.3.0        evaluate_0.14      
## [13] httr_1.4.2          pillar_1.4.6        rlang_0.4.7        
## [16] curl_4.3            lazyeval_0.2.2      readxl_1.3.1       
## [19] rstudioapi_0.11     blob_1.2.1          magick_2.5.0       
## [22] rmarkdown_2.3       labeling_0.3        munsell_0.5.0      
## [25] broom_0.7.0         compiler_3.6.3      modelr_0.1.8       
## [28] xfun_0.16           gridGraphics_0.5-0  pkgconfig_2.0.3    
## [31] htmltools_0.5.0     tidyselect_1.1.0    fansi_0.4.1        
## [34] crayon_1.3.4        dbplyr_1.4.4        withr_2.2.0        
## [37] grid_3.6.3          nlme_3.1-144        jsonlite_1.7.0     
## [40] gtable_0.3.0        lifecycle_0.2.0     DBI_1.1.0          
## [43] magrittr_1.5        scales_1.1.1        tidytree_0.3.3     
## [46] cli_2.0.2           stringi_1.4.6       farver_2.0.3       
## [49] fs_1.5.0            xml2_1.3.2          ellipsis_0.3.1     
## [52] rvcheck_0.1.8       generics_0.0.2      vctrs_0.3.2        
## [55] tools_3.6.3         ggplotify_0.0.5     glue_1.4.1         
## [58] hms_0.5.3           parallel_3.6.3      yaml_2.2.1         
## [61] colorspace_1.4-1    BiocManager_1.30.10 rvest_0.3.6        
## [64] haven_2.3.1</code></pre>
</div>
<p><strong>End of document</strong></p>
</div>


<div class="footer">
<div class="container" style="padding-top:5px;padding-bottom:5px;">
<p>
<span style="float:left; vertical-align:middle">
<b>2020 </b><a href="https://nbis.se/">NBIS</a> • <a href="https://www.scilifelab.se/">SciLifeLab</a> • <a href="https://www.biology.lu.se/education/phd-studies/graduate-research-school-in-genomic-ecology">GENECO</a>
</span>
<span style="float:right; vertical-align:middle">
<span class="footericon" style="padding-right:4px; padding-left:4px">
<a href="https://nbis.se/"><i class="fas fa-globe-americas"></i></a>
</span>
<span class="footericon" style="padding-right:4px; padding-left:4px">
<a href="https://twitter.com/NBISwe"><i class="fab fa-twitter"></i></a>
</span>
<span class="footericon" style="padding-left:4px">
<a href="https://www.linkedin.com/company/nbisweden/"><i class="fab fa-linkedin"></i></a>
</span>
</span>
</p>
</div>
</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
